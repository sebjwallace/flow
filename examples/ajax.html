<!doctype html>
<html lang="en">

	<head>
	  <meta charset="utf-8">
	  <title>Ajax</title>
	</head>

	<body>
	</body>

	<script src="../dist/flow.js"></script>

	<script>
		
	var $ = Flow.$
	var $ajax = Flow.$ajax
	var $action = Flow.$action

	var address = 'http://jsonplaceholder.typicode.com/posts/1'
	// loadAjax(address)

	function loadAjax(url){
			$('GET', url)
			.default(
				$('div').text('loading data...')
			)
			.success(function(data){
				return $('div')
					.background(200,220,250)
					.padding(20)
					.justify('space-around')
					.items('baseline')
					.columns(
						$('h1').text(data.title),
						$('p').text(data.body),
						$('button')
							.text('retry but with error')
							.onclick(function(){
								loadAjax('http://nosuchurl')
							})
					)
			})
			.error(function(){
				return $()
					.background(200,150,120)
					.padding(20)
					.text('The data could not be loaded')
					.justify('space-between')
					.columns(
						$('button')
						.text('retry with success')
						.onclick(function(){
							loadAjax(address)
						})
					)
			})
			.render()
	}


	function renderJSON(data){

		if(!data)
			return $('div')
				.text('loading data...')

		return $('div')
			.background(200,220,250)
			.padding(20)
			.justify('space-around')
			.items('baseline')
			.columns(
				$('h1').text(data.title),
				$('p').text(data.body),
				$('button')
					.text('retry but with error')
					.onclick(function(){
						getData('http://nosuchurl')
					})
			)
	}


	$action.pull('@loadedData', function(data){
		renderJSON(data).render()
	})

	function getData(url){
		$ajax().get(url)
		.always(function(data){
			$action.push('@loadedData',data)()
		})
	}

	renderJSON().render()
	getData(address)

	</script>

 </html>