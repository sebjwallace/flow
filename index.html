<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>schema</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/javascript" src="dist/schema.js"></script>

    <script type="text/javascript">

      Schema.model({
        todos: [
          {title: 'sample todo', completed: true}
        ],
        add: function(self,params){
          return self.todos.concat(params.todo)
        },
        remove: function(self,params){
          return self.todos.splice(params.index,1)
        },
        toggle: function(self,id){
          var completed = self.todos[id].completed;
          self.todos[id].completed = (completed ? false : true);
          return self.todos;
        },
        load: {
          url: '...'
        },
        save: {
          url: '...'
        }
      });

      const Todos = {
        data: {
          current: '',
          todos: []
        },
        template: ['#todos',
          ['input',
            '!onchange: setCurrent',
            'focus()', 'placeholder: add todo',
            'value: $current', ''
          ],
          ['ul', '% $todo in $todos',
            ['li', '!onclick: toggleTodo($$)', '$todo.title', function($){
                if($.data.todo.completed)
                  return 'style: text-decoration:line-through'
              }
            ]
          ],
          ['button', '!onclick: addTodo', 'Add'],
          ['button', '!onclick: saveTodo', 'Save'],
          ['p', function($){
            let incomplete = 0;
            $.data.todos.forEach(function(todo){
              if(!todo.completed) incomplete++;
            })
            return incomplete + ' items left';
          }]
        ],
        styles: [
          ['#todos',
            'position absolute',
            'width 560px',
            'margin auto',
            'border 1px solid #ddd'
          ],
          ['li', 'border 1px solid #ddd']
        ],
        setCurrent: function(self,e){
          self.setData({current:e.target.value})
        },
        addTodo: function(self){
          self.updateModel('todos','add',{
            todo: {title: self.data.current}
          });
          self.setData({current: ''})
        },
        saveTodo: function(self){
          self.saveModel('todos')
        },
        toggleTodo: function(self,e,id){
          self.updateModel('todos','toggle',id)
        },
        boot: function(self){
          self.attachModel('todos')
        }
      }

      Schema.engine(Todos,document.getElementById('root'));

      const Schem = {
        data: { title: 'this is a nav' },
        template: [ '#whole',
          ['#mainBlock', '$name'],
          ['i', '$message'],
          ['div', '>']
        ],
        styles: [
          ['', 'background-color #ddd'],
          ['#whole',
            ['!onclick',
              'background-color rgba(0,0,0,0.7)',
              'color white'
            ]
          ]
        ],
        onChange: (self) => {
          self.setData({ name: self.data.name + ' yo man' })
        },
        init: (self) => {
          self.setData({message: 'loaded!'})
        }
      };

      const Component = {
        data:{
          intro: 'intro heyy',
          list: [{name:'tom', hobby:'trekking'},{name:'sam', hobby:'biking'}]
        },
        template: [ 'div',
          [Schem, {name: 'james'}, '#topNav', ['span', 'top nav']],
          ['section', '#intro', '? $intro', '!onclick: clicked',
              '>',
              ['h1', '$intro'],
              ['p', '.text', 'paragraph this is'],
              ['a', 'href: www.google.com', 'link to google'],
              ['ul', '% $item in $list',
                ['li',
                  ['h3', '$item.name'],
                  ['a', '$item.hobby']
                ]
              ],
              ['button', '#toggle', 'Toggle']
          ],
          [Schem, {name: 'tom'}, '#bottomNav', ['span', 'bottom naavvv']]
        ],
        styles: [
          ['#topNav', 'color orange'],
          ['#intro', 'color green', 'padding 10px'],
          ['#toggle',
            ['!onclick', '@toggle']
          ],
          ['#bottomNav', 'color #aedb33', 'font-size 2em',
            ['@toggle', 'font-size 1em', 'color #333', 'background-color #f1f1f1']
          ]
        ],
        clicked: (self,e) => {
          self.setData({intro: 'clicked'});
          self.setStyles([['#intro', 'color brown']])
          self.heylo();
        },
        heylo: () => {
          console.log('mannnnn!!');
        }
      }

      // Schema.engine(Component,document.getElementById('root'));
    </script>
  </body>
</html>
